(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{57:function(t,a,e){"use strict";function s(t,a,e,s,o,r,i,n){var l,d="function"==typeof t?t.options:t;if(a&&(d.render=a,d.staticRenderFns=e,d._compiled=!0),s&&(d.functional=!0),r&&(d._scopeId="data-v-"+r),i?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(i)},d._ssrRegister=l):o&&(l=n?function(){o.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:o),l)if(d.functional){d._injectStyles=l;var u=d.render;d.render=function(t,a){return l.call(a),u(t,a)}}else{var p=d.beforeCreate;d.beforeCreate=p?[].concat(p,l):[l]}return{exports:t,options:d}}e.d(a,"a",(function(){return s}))},77:function(t,a,e){"use strict";e.r(a);var s={name:"user.profile",data:function(){return{userId:null,name:null,description:null,banned:0,admin:0,createdAt:null,updatedAt:null,avatar:null,email:null,oldPassword:null,confirmPassword:null,newPassword:null,authenticated:auth.check(),authUser:auth.user,labels:{submit:"загрузить",cancel:"отмена"},uploadHeaders:{Authorization:"Bearer "+auth.token},outputOptions:{},cropperOptions:{maxWidth:150,maxHeight:150,aspectRatio:1,autoCropArea:1,viewMode:1,movable:!0,zoomable:!1},imageUploadMes:""}},mounted:function(){var t=this;this.loadUser(),Event.$on("userLoggedIn",(function(){t.authenticated=!0,t.user=auth.user,t.authUser=auth.user})),Event.$on("userLogout",(function(){t.authenticated=!1,t.authUser=null}))},methods:{updateAccount:function(){this.oldPassword&&this.updatePassword();var t=new window.apiUser;t.email=this.email,t.update(this.authUser.user_id),Vue.notify({group:"auth",text:"Пожалуйста, зайдите в вашу учетную запись ещё раз"}),auth.logout()},updatePassword:function(){if(this.newPassword.length<8)return Vue.notify({group:"auth",title:"Произошла ошибка",text:"Поле с паролем должно быть длиннее 8 символов"}),null;if(this.newPassword!==this.confirmPassword)return Vue.notify({group:"auth",title:"Произошла ошибка",text:"Пароли не совпадают"}),null;var t=new FormData;t.append("oldPassword",this.oldPassword),t.append("password",this.newPassword),t.append("password_confirmation",this.confirmPassword),api.call("post","/api/user/password",t).then((function(t){Vue.notify({group:"auth",title:"Смена пароля",text:"Пароль успешно обновлен"})})).catch((function(t){Vue.notify({group:"auth",title:"Произошла ошибка",text:"Введен неверный старый пароль"})})),this.newPassword="",this.oldPassword="",this.confirmPassword=""},updateProfile:function(){var t=new window.apiUser;t.name=this.name,t.description=this.description,t.update(this.authUser.user_id)},loadUser:function(){var t=this,a=new window.apiUser;a.get(this.$route.params.userId).then((function(){t.userId=a.id,t.name=a.name,t.email=a.email,t.description=a.description,t.avatar=a.avatar,t.banned=a.banned,t.admin=a.admin,t.createdAt=a.createdAt,t.updatedAt=a.updatedAt}))},handleUploading:function(t,a){this.imageUploadMes="Идет загрузка..."},handleUploaded:function(t,a,e){this.avatar=t.avatar.name,this.imageUploadMes=""},handleCompleted:function(t,a,e){},handlerError:function(t,a,e){this.imageUploadMes="Произошла ошибка при загрузке изображения"}}},o=e(57),r=Object(o.a)(s,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("div",{staticClass:"sidebar-wrap"},[t.userId?e("div",{staticClass:"sidebar-box p-4 about text-center ftco-animate"},[e("img",{staticClass:"img-fluid",attrs:{src:"/storage/images/avatars/"+t.avatar}}),t._v(" "),e("avatar-cropper",{attrs:{trigger:"#uploadAvatar","upload-url":"/api/user/upload-avatar/"+t.userId,"upload-form-name":"avatar",labels:t.labels,uploadHeaders:t.uploadHeaders,"output-options":t.outputOptions,"cropper-options":t.cropperOptions},on:{uploading:t.handleUploading,uploaded:t.handleUploaded,completed:t.handleCompleted,error:t.handlerError}}),t._v(" "),e("p",{staticClass:" mb-2"},[t._v(t._s(t.name))]),t._v(" "),t.admin?e("p",{staticClass:"m-2",staticStyle:{color:"red"}},[t._v("Администратор")]):t._e(),t._v(" "),t.banned?e("p",{staticClass:"m-2",staticStyle:{color:"red"}},[t._v("Заблокирован")]):t._e(),t._v(" "),e("div",{staticClass:"pt-4"},[t.description?e("p",{staticClass:"text-break"},[t._v(t._s(t.description))]):t._e()])],1):e("div",{staticClass:"sidebar-box p-4 about text-center ftco-animate"},[e("p",[t._v("Пользователь не найден")])])]),t._v(" "),t.authUser&&t.userId&&t.authUser.user_id===t.userId?e("div",{staticClass:"container"},[t._m(0),t._v(" "),e("div",{staticClass:"tab-content",attrs:{id:"myTabContent"}},[e("div",{staticClass:"tab-pane fade show active",attrs:{id:"home",role:"tabpanel","aria-labelledby":"home-tab"}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"statusInput"}},[t._v("Статус")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"form-control",attrs:{type:"text",id:"statusInput"},domProps:{value:t.description},on:{input:function(a){a.target.composing||(t.description=a.target.value)}}})]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"uploadAvatar"}},[t._v("Аватар")]),t._v(" "),e("p",[t._v(t._s(t.imageUploadMes))]),t._v(" "),e("button",{staticClass:"btn btn-primary btn-block",attrs:{id:"uploadAvatar"}},[t._v("Загрузить новый аватар")])]),t._v(" "),e("span",{staticClass:"btn btn-primary btn-block",on:{click:function(a){return t.updateProfile()}}},[t._v("Обновить")])]),t._v(" "),e("div",{staticClass:"tab-pane fade",attrs:{id:"profile",role:"tabpanel","aria-labelledby":"profile-tab"}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"emailInput"}},[t._v("Email")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.email,expression:"email"}],staticClass:"form-control",attrs:{type:"text",id:"emailInput"},domProps:{value:t.email},on:{input:function(a){a.target.composing||(t.email=a.target.value)}}})]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"oldPasswordInput"}},[t._v("Старый пароль")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.oldPassword,expression:"oldPassword"}],staticClass:"form-control",attrs:{type:"password",id:"oldPasswordInput"},domProps:{value:t.oldPassword},on:{input:function(a){a.target.composing||(t.oldPassword=a.target.value)}}})]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"passwordInput"}},[t._v("Новый пароль")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newPassword,expression:"newPassword"}],staticClass:"form-control",attrs:{type:"password",id:"passwordInput"},domProps:{value:t.newPassword},on:{input:function(a){a.target.composing||(t.newPassword=a.target.value)}}})]),t._v(" "),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"confirmInput"}},[t._v("Повторите пароль")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.confirmPassword,expression:"confirmPassword"}],staticClass:"form-control",attrs:{type:"password",id:"confirmInput"},domProps:{value:t.confirmPassword},on:{input:function(a){a.target.composing||(t.confirmPassword=a.target.value)}}})]),t._v(" "),e("span",{staticClass:"btn btn-primary btn-block",on:{click:function(a){return t.updateAccount()}}},[t._v("Обновить")])])])]):t._e()])}),[function(){var t=this.$createElement,a=this._self._c||t;return a("ul",{staticClass:"nav nav-tabs",attrs:{id:"myTab",role:"tablist"}},[a("li",{staticClass:"nav-item",attrs:{role:"presentation"}},[a("a",{staticClass:"nav-link active",attrs:{id:"home-tab","data-toggle":"tab",href:"#home",role:"tab","aria-controls":"home","aria-selected":"true"}},[this._v("Настройки профиля")])]),this._v(" "),a("li",{staticClass:"nav-item",attrs:{role:"presentation"}},[a("a",{staticClass:"nav-link",attrs:{id:"profile-tab","data-toggle":"tab",href:"#profile",role:"tab","aria-controls":"profile","aria-selected":"false"}},[this._v("Настройки учетной записи")])])])}],!1,null,"af83fe14",null);a.default=r.exports}}]);